<!-- C:\Mail.ru\CodeIt\Django\BalkanPearl\BalkanPearlProject\BalkanPearlApp\templates\booking_wizard.html -->
{% extends 'base.html' %}
{% load i18n %}
{% load static %}

{% block content %}
<h2>{% trans "Мастер бронирования" %}</h2>

<!-- Форма для выбора дат и количества гостей -->
<div class="date-selection" style="position: fixed; top: 150px; width: 100%; background: rgba(255, 255, 255, 0.9); padding: 10px;  z-index: 999;">
    <!--<h3>{% trans "Внесите желаемые даты и количество гостей" %}</h3>-->
    <form id="wizard-form" style="display: flex; gap: 10px; justify-content: center; margin-top: 10px;" >
        <h3>{% trans "Внесите желаемые даты и количество гостей" %}</h3>
        <input type="date" id="check_in" name="check_in" required style="padding: 8px;" value="{{ check_in }}">
        <input type="date" id="check_out" name="check_out" required style="padding: 8px;" value="{{ check_out }}">
        <input type="number" id="people_quantity" name="people_quantity" min="1" required style="padding: 8px;" value="{{ people_quantity }}">
        <button type="submit" style="padding: 8px 20px; background: #007bff; color: white; border: none; border-radius: 4px; cursor: pointer;">
            {% trans "Найти доступные номера" %}
        </button>
    </form>
</div>

<!-- Список доступных апартаментов -->
<div id="apartments-list">
    {% for apartment in apartments %}
    <div class="apartment" style="display: flex; gap: 20px; margin-bottom: 20px; background: rgba(255,255,255,0.8); padding: 20px; border-radius: 8px;">
        <!-- Левый блок: Описание -->
        <section class="description" style="flex: 1;">
            <h3>{% trans 'Номер апартамента' %}: {{ apartment.number }}</h3>
            <p><strong>{% trans 'Описание' %}:</strong> {{ apartment.description }}</p>
            <p><strong>{% trans 'Макс. гостей' %}:</strong> {{ apartment.capacity }}</p>
            <p><strong>{% trans 'Тип' %}:</strong> {{ apartment.type.name }}</p>
            <p><strong>{% trans 'Вид из окна' %}:</strong> {{ apartment.window_view.view }}</p>
            <p><strong>{% trans 'Вместимость номера' %}:</strong> {{ apartment.capacity }}</p>
            <p><strong>{% trans "Стоимость:" %}</strong> {{ apartment.price }} €</p>
            <button onclick="bookApartment({{ apartment.id }})">{% trans "Забронировать" %}</button>
        </section>
        <!-- Правый блок: Карусель -->
        <section class="carousel-container" style="flex: 1;">
            <div class="carousel" data-carousel-id="{{ forloop.counter }}">
                <button class="prev">&laquo;</button>
                {% for photo in apartment.photos %}
                    <img src="{{ photo.photo }}" alt="{% trans 'Фото апартамента' %}" style="max-width: 100%; height: 300px; object-fit: cover; {% if not forloop.first %}display: none;{% endif %}">
                {% endfor %}
                <button class="next">&raquo;</button>
            </div>
        </section>
    </div>
    {% endfor %}
</div>

<script>
// Обработчик для карусели
document.addEventListener('DOMContentLoaded', () => {
    document.querySelectorAll('.carousel').forEach(carousel => {
        const images = Array.from(carousel.querySelectorAll('img'));
        const prevBtn = carousel.querySelector('.prev');
        const nextBtn = carousel.querySelector('.next');
        let currentIndex = 0;

        function showImage(index) {
            images.forEach((img, i) => {
                img.style.display = i === index ? 'block' : 'none';
            });
        }

        if (images.length > 0) {
            showImage(0);

            prevBtn.addEventListener('click', () => {
                currentIndex = (currentIndex - 1 + images.length) % images.length;
                showImage(currentIndex);
            });

            nextBtn.addEventListener('click', () => {
                currentIndex = (currentIndex + 1) % images.length;
                showImage(currentIndex);
            });
        } else {
            prevBtn.style.display = 'none';
            nextBtn.style.display = 'none';
        }
    });
});

// Обработчик для формы мастера бронирования
document.getElementById('wizard-form').addEventListener('submit', function(event) {
    event.preventDefault();
    const checkIn = document.getElementById('check_in').value;
    const checkOut = document.getElementById('check_out').value;
    const peopleQuantity = document.getElementById('people_quantity').value;

    // Перенаправляем на ту же страницу с параметрами
    window.location.href = `{% url 'booking_wizard' %}?check_in=${checkIn}&check_out=${checkOut}&people_quantity=${peopleQuantity}`;
});
</script>
{% endblock %}